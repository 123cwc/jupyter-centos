#!/bin/bash

pushd /root/src/tools/cling/tools/Jupyter

# The cling configure/make system doesn't build the Jupyter kernel shared library.
# These commands were generated with the cmake build system and cleaned up a bit.

/usr/bin/c++ -DCLING_INCLUDE_PATHS=\"/usr/local/include:/root/src/tools/cling/include:/root/src/tools/cling/../clang/include:/root/src/tools/cling/../../include\" -DCLING_VERSION="ROOT_0.2~dev" -DGTEST_HAS_RTTI=0 -D_GNU_SOURCE -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -I/root/build/tools/cling/tools/Jupyter -I/root/src/tools/cling/tools/Jupyter -I/root/src/tools/cling/include -I/root/build/tools/cling/include -I/root/src/tools/cling/../clang/include -I/root/build/tools/cling/../clang/include -I/root/src/tools/cling/../llvm/src/tools/clang/include -I/root/build/tools/cling/../llvm/src/tools/clang/include -I/root/build/include -I/root/src/include  -fpermissive -D_GLIBCXX_USE_CXX11_ABI=0  -fPIC -fvisibility-inlines-hidden -Wall -W -Wno-unused-parameter -Wwrite-strings -Wcast-qual -Wno-missing-field-initializers -pedantic -Wno-long-long -Wno-maybe-uninitialized -Wnon-virtual-dtor -Wno-comment -std=c++11 -ffunction-sections -fdata-sections -fno-common -Woverloaded-virtual -Wcast-qual -fno-strict-aliasing -pedantic -Wno-long-long -Wall -W -Wno-unused-parameter -Wwrite-strings -Wno-unused-local-typedefs -fPIC   -fno-rtti -fno-exceptions -fno-rtti -o Kernel.cpp.o -c Kernel.cpp

/usr/bin/c++  -fPIC -fpermissive -D_GLIBCXX_USE_CXX11_ABI=0  -fPIC -fvisibility-inlines-hidden -Wall -W -Wno-unused-parameter -Wwrite-strings -Wcast-qual -Wno-missing-field-initializers -pedantic -Wno-long-long -Wno-maybe-uninitialized -Wnon-virtual-dtor -Wno-comment -std=c++11 -ffunction-sections -fdata-sections -fno-common -Woverloaded-virtual -Wcast-qual -fno-strict-aliasing -pedantic -Wno-long-long -Wall -W -Wno-unused-parameter -Wwrite-strings -Wno-unused-local-typedefs  -Wl,-O3  -Wl,-z,defs -shared -Wl,-soname,libclingJupyter.so -o /usr/local/lib/libclingJupyter.so Kernel.cpp.o /usr/local/lib/libclangAST.a /usr/local/lib/libclangBasic.a /usr/local/lib/libclangCodeGen.a /usr/local/lib/libclangDriver.a /usr/local/lib/libclangFrontend.a /usr/local/lib/libclangLex.a /usr/local/lib/libclangParse.a /usr/local/lib/libclangSema.a /usr/local/lib/libclangSerialization.a /usr/local/lib/libclingUserInterface.a /usr/local/lib/libclingMetaProcessor.a /usr/local/lib/libclingInterpreter.a /usr/local/lib/libclingUtils.a /usr/local/lib/libLLVMCore.a /usr/local/lib/libLLVMSupport.a /usr/local/lib/libLLVMMCJIT.a /usr/local/lib/libLLVMOrcJIT.a /usr/local/lib/libLLVMExecutionEngine.a /usr/local/lib/libLLVMRuntimeDyld.a /usr/local/lib/libLLVMX86AsmParser.a /usr/local/lib/libLLVMX86CodeGen.a /usr/local/lib/libLLVMAsmPrinter.a /usr/local/lib/libLLVMSelectionDAG.a /usr/local/lib/libLLVMCodeGen.a /usr/local/lib/libLLVMTarget.a /usr/local/lib/libLLVMX86Desc.a /usr/local/lib/libLLVMX86AsmPrinter.a /usr/local/lib/libLLVMX86Utils.a /usr/local/lib/libLLVMX86Disassembler.a /usr/local/lib/libLLVMX86Info.a /usr/local/lib/libLLVMMCDisassembler.a /usr/local/lib/libclangCodeGen.a /usr/local/lib/libclangFrontend.a /usr/local/lib/libclangDriver.a /usr/local/lib/libclangParse.a /usr/local/lib/libclangSerialization.a /usr/local/lib/libclangSema.a /usr/local/lib/libclangAnalysis.a /usr/local/lib/libLLVMOption.a /usr/local/lib/libclangEdit.a /usr/local/lib/libclangAST.a /usr/local/lib/libclangLex.a /usr/local/lib/libclangBasic.a /usr/local/lib/libLLVMBitWriter.a /usr/local/lib/libLLVMipo.a /usr/local/lib/libLLVMVectorize.a /usr/local/lib/libLLVMIRReader.a /usr/local/lib/libLLVMAsmParser.a /usr/local/lib/libLLVMInstrumentation.a /usr/local/lib/libLLVMLinker.a /usr/local/lib/libLLVMObjCARCOpts.a /usr/local/lib/libLLVMScalarOpts.a /usr/local/lib/libLLVMInstCombine.a /usr/local/lib/libLLVMProfileData.a /usr/local/lib/libLLVMObject.a /usr/local/lib/libLLVMBitReader.a /usr/local/lib/libLLVMMCParser.a /usr/local/lib/libLLVMMC.a /usr/local/lib/libLLVMTransformUtils.a /usr/local/lib/libLLVMipa.a /usr/local/lib/libLLVMAnalysis.a /usr/local/lib/libLLVMCore.a /usr/local/lib/libLLVMSupport.a -lrt -ldl -latomic -lpthread -lm -Wl,-rpath,"\$ORIGIN/../lib" 

# Now install the kernel itself

cd /root/src/tools/cling/tools/Jupyter/kernel
pip install .
jupyter kernelspec install cling
cp scripts/jupyter-cling-kernel /usr/local/bin

popd
